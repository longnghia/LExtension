(()=>{"use strict";function e(e){let o;try{o=new URL(e)}catch(e){return!1}return!0}function o(e){browser.storage.local.get(null,(function(o){if(o.collection)for(let t=0;t<o.collection.length;t++){let r=o.collection[t];if(e.url.startsWith(r))return void console.log("not close postman ok :3")}else console.log("collection null");browser.tabs.remove(e.id)}))}const t="[Background]";browser.browserAction.setBadgeBackgroundColor({color:"blue"});let r="read-later",n=!1;browser.storage.local.get().then((e=>{var o,t,n,l;null!==(o=e[r])&&void 0!==o&&o.length||browser.storage.local.set({"read-later":[]}),null!==(t=e.collection)&&void 0!==t&&t.length||browser.storage.local.set({collection:["https://github.dev"]}),null!==(n=e.omniboxs)&&void 0!==n&&n.length||browser.storage.local.set({omniboxs:[{src:"ios",des:"https://github.com/search?o=desc&q=stars%3A%3E%3D20+fork%3Atrue+language%3Aswift&s=updated&type=Repositories"}]}),null!==(l=e.background)&&void 0!==l&&l.length||browser.storage.local.set({background:["mylivewallpapers.com-Yellow-Space-Suit-Girl.webm"]})})),browser.omnibox.setDefaultSuggestion({description:'Search:\n      (e.g. "android" | "ios")'}),browser.omnibox.onInputEntered.addListener((function(e){let o="https://google.com";e=e.trim(),browser.storage.local.get().then((r=>{r&&r.omniboxs&&r.omniboxs.forEach((r=>{r.src==e&&(o=r.des,console.log(`${t} found`,e))})),chrome.tabs.update({url:o})}))}));let l=[];function s(){console.log(`${t} isReady=`,n)}function a(e){console.log(`${t} ERROR`,e)}function c(e){var o;return(null===(o=e.url)||void 0===o?void 0:o.startsWith("http"))??!1}function i(e){return{url:e.url,title:e.title,date:Date()}}console.log(`${t} Loaded.`),s(),browser.storage.onChanged.addListener((function(e,o){console.log(`Change in storage area: ${o}`);const t=Object.keys(e);for(const o of t)console.log(`${o} has changed:`),console.log("Old value: ",e[o].oldValue),console.log("New value: ",e[o].newValue)})),browser.storage.local.get().then((e=>{n=!0,s(),l=e[r],console.log(`${t} DB Loaded`,l),browser.browserAction.setBadgeText({text:`${l.length}`})})),browser.commands.onCommand.addListener((async s=>{switch(console.log(`${t} command= ${s}`),s){case r:await async function(){if(!n)return void console.log(`${t} Extension not ready!`);let e=await async function(){return(await browser.tabs.query({highlighted:!0,currentWindow:!0})).filter(c).map(i)}();browser.storage.local.get().then((o=>{console.log(`${t} savePage`,o),l=o[r];let n=e.filter((e=>{return o=e,!l.some((e=>e.url==o.url));var o}));0!=n.length?(n.forEach((e=>{l.push(e)})),browser.storage.local.set({"read-later":l}).then((function(){var e;console.log(`${t} SUCCESS saved ${n.length} tabs.`),e=l.length,browser.storage.local.get().then((o=>{browser.browserAction.setBadgeText({text:`${e||o[r].length}`})}))}),a)):console.log(`${t} Tabs exist!`,e)}),a)}();break;case"logTabs":browser.tabs.query({currentWindow:!0},(function(e){let o=e.reduce(((e,o)=>(e.push({title:o.title,url:o.url}),e)),[]);const t=document.createElement("a");t.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(o)),t.download=e[0].title+".json",t.click()}));break;case"dublicateTab":browser.tabs.query({active:!0,currentWindow:!0},(function(e){browser.tabs.create({active:!1,openerTabId:e[0].id,index:e[0].index+1,url:e[0].url})}));break;case"open-in-bg":!function(o){browser.tabs.query({active:!0,currentWindow:!0},(function(t){browser.tabs.sendMessage(t[0].id,{action:"open-selected",command:o},(function(t){t&&t.link&&function(o,t){browser.tabs.query({active:!0,currentWindow:!0},(function(r){browser.tabs.create({url:e(o)?o:"https://www.google.com/search?q="+o,active:"open-in-bg"!==t,index:r[0].index+1})}))}(t.link,o)}))}))}(s);break;case"fakeCtrlW":console.log("ctr W!"),browser.tabs.query({highlighted:!0,currentWindow:!0},(function(e){for(tab of e)o(tab)}))}}))})();
//# sourceMappingURL=background.js.map