{"version":3,"file":"background.js","mappings":"mBA0EA,SAASA,EAAMC,GACX,IAAIC,EAEJ,IACIA,EAAM,IAAIC,IAAIF,EAIlB,CAHE,MAAOG,GAEL,OAAO,CACX,CACA,OAAO,CAEX,CAiBA,SAASC,EAAeC,GACpBC,QAAQC,QAAQC,MAAMC,IAAI,MAAM,SAAUC,GACtC,GAAIA,EAAKC,WACL,IAAK,IAAIC,EAAI,EAAGA,EAAIF,EAAKC,WAAWE,OAAQD,IAAK,CAC7C,IAAIX,EAAMS,EAAKC,WAAWC,GAC1B,GAAIP,EAAIJ,IAAIa,WAAWb,GAGnB,YADAc,QAAQC,IAAI,0BAGpB,MAEAD,QAAQC,IAAI,mBAEhBV,QAAQW,KAAKC,OAAOb,EAAIc,GAC5B,GACJ,CCpHA,MAAMC,EAAM,eAEZd,QAAQe,cAAcC,wBAAwB,CAAE,MAAS,SAMzD,IAAIC,EAAY,aACZC,GAAU,EAGdlB,QAAQC,QAAQC,MAAMC,MAAMgB,MAAKlB,IAAW,YACjB,QAAnB,EAACA,EAAQgB,UAAU,OAAlB,EAAoBV,QACrBP,QAAQC,QAAQC,MAAMkB,IAAI,CAAE,aAAc,KAGpB,QAAtB,EAACnB,EAAoB,kBAAC,OAArB,EAAuBM,QACxBP,QAAQC,QAAQC,MAAMkB,IAAI,CAAE,WAAc,CAAC,wBAGvB,QAApB,EAACnB,EAAkB,gBAAC,OAAnB,EAAqBM,QACtBP,QAAQC,QAAQC,MAAMkB,IAAI,CACtB,SAAY,CACR,CACIC,IAAK,MACLC,IAAK,mHAMK,QAAtB,EAACrB,EAAoB,kBAAC,OAArB,EAAuBM,QACxBP,QAAQC,QAAQC,MAAMkB,IAAI,CAAE,WAAc,CAAC,qDAC/C,IAKJpB,QAAQuB,QAAQC,qBAAqB,CACjCC,YAAc,4CAIlBzB,QAAQuB,QAAQG,eAAeC,aAAY,SAAUC,GACjD,IAAIC,EAAS,qBACbD,EAAOA,EAAKE,OACZ9B,QAAQC,QAAQC,MAAMC,MAAMgB,MAAKf,IAC7BA,GAAQA,EAAK2B,UAAY3B,EAAK2B,SAASC,SAAQC,IACvCA,EAAIZ,KAAOO,IACXC,EAASI,EAAIX,IACbb,QAAQC,IAAK,GAAEI,UAAac,GAChC,IAGJM,OAAOvB,KAAKwB,OAAO,CACfxC,IAAKkC,GACP,GAEV,IAIA,IAAIO,EAAK,GA0DT,SAASC,IACL5B,QAAQC,IAAK,GAAEI,aAAgBI,EACnC,CAkCA,SAASoB,EAAQC,GACb9B,QAAQC,IAAK,GAAEI,UAAayB,EAChC,CAmBA,SAASC,EAASzC,GAAK,MAEnB,OAAc,QAAP,EAAAA,EAAIJ,WAAG,aAAP,EAASa,WAAW,WAAW,CAC1C,CAEA,SAASiC,EAAa1C,GAClB,MAAO,CACHJ,IAAKI,EAAIJ,IACT+C,MAAO3C,EAAI2C,MAEXC,KAAMC,OAEd,CA7HAnC,QAAQC,IAAK,GAAEI,aAEfuB,IAeArC,QAAQC,QAAQ4C,UAAUlB,aAb1B,SAA0BmB,EAASC,GAE/BtC,QAAQC,IAAK,2BAA0BqC,KAEvC,MAAMC,EAAeC,OAAOC,KAAKJ,GAEjC,IAAK,MAAMK,KAAQH,EACfvC,QAAQC,IAAK,GAAEyC,kBACf1C,QAAQC,IAAI,cAAeoC,EAAQK,GAAMC,UACzC3C,QAAQC,IAAI,cAAeoC,EAAQK,GAAME,SAEjD,IAKArD,QAAQC,QAAQC,MAAMC,MAAMgB,MAAKlB,IAC7BiB,GAAU,EACVmB,IAEAD,EAAKnC,EAAQgB,GAEbR,QAAQC,IAAK,GAAEI,cAAiBsB,GAEhCpC,QAAQe,cAAcuC,aAAa,CAAE1B,KAAO,GAAEQ,EAAG7B,UAAW,IAGhEP,QAAQuD,SAASC,UAAU7B,aAAY8B,UAGnC,OAFAhD,QAAQC,IAAK,GAAEI,cAAgB4C,KAEvBA,GACJ,KAAKzC,QAyBbwC,iBAEI,IAAKvC,EAED,YADAT,QAAQC,IAAK,GAAEI,0BAInB,IAAIH,QAyCR8C,iBAEI,aADiBzD,QAAQW,KAAKgD,MAAM,CAAEC,aAAa,EAAMC,eAAe,KAC5DC,OAAOtB,GAAUuB,IAAItB,EACrC,CA5CqBuB,GAEjBhE,QAAQC,QAAQC,MAAMC,MAAMgB,MAAKlB,IAC7BQ,QAAQC,IAAK,GAAEI,aAAgBb,GAE/BmC,EAAKnC,EAAQgB,GAEb,IAAIgD,EAAUtD,EAAKmD,QAAO/D,IAAO,OA8BrBmE,EA9BiCnE,GA+B1CqC,EAAG+B,MAAKpE,GAAOA,EAAIJ,KAAOuE,EAAOvE,MAD5C,IAAoBuE,CA9BqC,IAE3B,GAAlBD,EAAQ1D,QAKZ0D,EAAQjC,SAAQjC,IACZqC,EAAGgC,KAAKrE,EAAI,IAGhBC,QAAQC,QAAQC,MAAMkB,IAAI,CAAE,aAAcgB,IAAMjB,MAAK,WAW7D,IAAqBZ,EAVTE,QAAQC,IAAK,GAAEI,mBAAqBmD,EAAQ1D,gBAUnCA,EATG6B,EAAG7B,OAUvBP,QAAQC,QAAQC,MAAMC,MAAMgB,MAAKlB,IAC7BD,QAAQe,cAAcuC,aAAa,CAC/B1B,KAAO,GAAErB,GAAkBN,EAAQgB,GAAWV,UAChD,GAZF,GAAG+B,IAXC7B,QAAQC,IAAK,GAAEI,gBAAmBH,EAW3B,GACZ2B,EACP,CAtDkB+B,GACN,MAEJ,IAAK,UDvGTrE,QAAQW,KAAKgD,MAAM,CACfE,eAAe,IAChB,SAAUlD,GACT,IAAI2D,EAAM3D,EAAK4D,QAAO,CAACC,EAAKzE,KACxByE,EAAIJ,KAAK,CAAE,MAASrE,EAAI2C,MAAO,IAAO3C,EAAIJ,MACnC6E,IACR,IACH,MAAMC,EAAOC,SAASC,cAAc,KAEpCF,EAAKG,KAAO,gCAAkCC,mBAAmBC,KAAKC,UAAUT,IAChFG,EAAKO,SAAWrE,EAAK,GAAG+B,MAAQ,QAChC+B,EAAKQ,OAET,IC4FQ,MACJ,IAAK,eDzFTjF,QAAQW,KAAKgD,MAAM,CACfuB,QAAQ,EACRrB,eAAe,IAChB,SAAUlD,GACTX,QAAQW,KAAKwE,OAAO,CAChBD,QAAQ,EACRE,YAAazE,EAAK,GAAGE,GACrBwE,MAAO1E,EAAK,GAAG0E,MAAQ,EACvB1F,IAAKgB,EAAK,GAAGhB,KAErB,ICiFQ,MACJ,IAAK,cDzBb,SAAsB+D,GAClB1D,QAAQW,KAAKgD,MAAM,CACfuB,QAAQ,EACRrB,eAAe,IAChB,SAAUlD,GACTX,QAAQW,KAAK2E,YAAY3E,EAAK,GAAGE,GAAI,CACjC0E,OAAQ,gBACR7B,QAASA,IACV,SAAU8B,GACTA,GAAYA,EAASf,MAjDjC,SAAiBA,EAAMf,GACnB1D,QAAQW,KAAKgD,MAAM,CACfuB,QAAQ,EACRrB,eAAe,IAChB,SAAUlD,GACTX,QAAQW,KAAKwE,OAAO,CAChBxF,IAAKF,EAAMgF,GAAQA,EAAO,mCAAqCA,EAC/DS,OAAoB,eAAZxB,EACR2B,MAAO1E,EAAK,GAAG0E,MAAQ,GAE/B,GAEJ,CAqCyCI,CAAQD,EAASf,KAAMf,EACxD,GACJ,GACJ,CCcYgC,CAAahC,GACb,MACJ,IAAK,YDMTjD,QAAQC,IAAI,UACZV,QAAQW,KAAKgD,MAAM,CACfC,aAAa,EACbC,eAAe,IAChB,SAAUlD,GACT,IAAKZ,OAAOY,EACRb,EAAeC,IAEvB,ICVc,G","sources":["webpack://firefox-extension-tempate/./src/Tabs.js","webpack://firefox-extension-tempate/./src/background.js"],"sourcesContent":["\n/* tabs */\nfunction saveTabs() {\n    browser.tabs.query({\n        currentWindow: true\n    }, function (tabs) {\n        let res = tabs.reduce((pre, tab) => {\n            pre.push({ 'title': tab.title, 'url': tab.url })\n            return pre\n        }, [])\n        const link = document.createElement('a');\n        // link.href = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(tabs))\n        link.href = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(res))\n        link.download = tabs[0].title + '.json';\n        link.click();\n\n    })\n}\n\nfunction dublicateTab() {\n    browser.tabs.query({\n        active: true,\n        currentWindow: true\n    }, function (tabs) {\n        browser.tabs.create({\n            active: false,\n            openerTabId: tabs[0].id,\n            index: tabs[0].index + 1,\n            url: tabs[0].url,\n        })\n    });\n}\n\nfunction save2Json(data) {\n    if (data) {\n        let url = URL.createObjectURL(new Blob([JSON.stringify(data)], {\n            type: \"text/plain\"\n        }))\n        const link = document.createElement('a');\n        link.href = url\n        link.download = 'read_later_' + new Date().toDateString().replaceAll(' ', '_') + '.json'\n        link.click();\n    }\n}\n\n/* Open selected */\n\nfunction openUrl(link, command) {\n    browser.tabs.query({\n        active: true,\n        currentWindow: true\n    }, function (tabs) {\n        browser.tabs.create({\n            url: isURL(link) ? link : 'https://www.google.com/search?q=' + link,\n            active: command === 'open-in-bg' ? false : true,\n            index: tabs[0].index + 1,\n        });\n    })\n\n}\n\nfunction openLink(href, active = false){\n    browser.tabs.query({\n        active: true,\n        currentWindow: true\n    }, function (tabs) {\n        browser.tabs.create({\n            url: href,\n            active: active,\n            index: tabs[0].index + 1,\n        });\n    })\n}\n\nfunction isURL(string) {\n    let url;\n\n    try {\n        url = new URL(string);\n    } catch (e) {\n        // console.error(e)\n        return false;\n    }\n    return true\n    // return url.protocol === \"http:\" || url.protocol === \"https:\";\n}\n\nfunction openSelected(command) {\n    browser.tabs.query({\n        active: true,\n        currentWindow: true\n    }, function (tabs) {\n        browser.tabs.sendMessage(tabs[0].id, {\n            action: \"open-selected\",\n            command: command\n        }, function (response) {\n            response && response.link && openUrl(response.link, command)\n        })\n    })\n}\n\n/* fake ctr w */\nfunction isInCollection(tab) {\n    browser.storage.local.get(null, function (data) {\n        if (data.collection) {\n            for (let i = 0; i < data.collection.length; i++) {\n                let url = data.collection[i];\n                if (tab.url.startsWith(url)) {\n                    // audio.play()\n                    console.log(\"not close postman ok :3\");\n                    return;\n                }\n            }\n        } else {\n            console.log(\"collection null\")\n        }\n        browser.tabs.remove(tab.id)\n    })\n}\n\nfunction doFakeCtrW() {\n    console.log(\"ctr W!\")\n    browser.tabs.query({\n        highlighted: true,\n        currentWindow: true\n    }, function (tabs) {\n        for (tab of tabs) {\n            isInCollection(tab)\n        }\n    })\n}\n\nexport { saveTabs, dublicateTab, save2Json, openUrl, openSelected, doFakeCtrW, openLink }","import { saveTabs, dublicateTab, save2Json, openUrl, openSelected, doFakeCtrW } from \"./Tabs\"\n\nconst TAG = \"[Background]\"\n\nbrowser.browserAction.setBadgeBackgroundColor({ 'color': 'blue' });\n\n// let gettingActiveTab = browser.tabs.query({ active: true, currentWindow: true });\n// let gettingSelectedTab = browser.tabs.query({ highlighted: true, currentWindow: true });\n\n\nlet readLater = \"read-later\"\nlet isReady = false\n\n// check and set database\nbrowser.storage.local.get().then(storage => {\n    if (!storage[readLater]?.length) {\n        browser.storage.local.set({ \"read-later\": [] })\n    }\n\n    if (!storage[\"collection\"]?.length) {\n        browser.storage.local.set({ \"collection\": [\"https://github.dev\"] })\n    }\n\n    if (!storage[\"omniboxs\"]?.length) {\n        browser.storage.local.set({\n            \"omniboxs\": [\n                {\n                    src: \"ios\",\n                    des: \"https://github.com/search?o=desc&q=stars%3A%3E%3D20+fork%3Atrue+language%3Aswift&s=updated&type=Repositories\"\n                }\n            ]\n        })\n    }\n    \n    if (!storage[\"background\"]?.length) {\n        browser.storage.local.set({ \"background\": [\"mylivewallpapers.com-Yellow-Space-Suit-Girl.webm\"] })\n    }\n})\n\n// Omnibox\n\nbrowser.omnibox.setDefaultSuggestion({\n    description: `Search:\n      (e.g. \"android\" | \"ios\")`\n});\n\nbrowser.omnibox.onInputEntered.addListener(function (text) {\n    let newURL = \"https://google.com\"\n    text = text.trim()\n    browser.storage.local.get().then(data => {\n        data && data.omniboxs && data.omniboxs.forEach(box => {\n            if (box.src == text){\n                newURL = box.des;\n                console.log(`${TAG} found`, text), newURL;\n            }\n        })\n\n        chrome.tabs.update({\n            url: newURL,\n        });\n    })\n});\n\n\n// let db = { \"read-later\": [] }\nlet db = []\n\nconsole.log(`${TAG} Loaded.`);\n\nsetActionIcon()\n\nfunction logStorageChange(changes, area) {\n\n    console.log(`Change in storage area: ${area}`);\n\n    const changedItems = Object.keys(changes);\n\n    for (const item of changedItems) {\n        console.log(`${item} has changed:`);\n        console.log(\"Old value: \", changes[item].oldValue);\n        console.log(\"New value: \", changes[item].newValue);\n    }\n}\n\nbrowser.storage.onChanged.addListener(logStorageChange);\n\n// init data\nbrowser.storage.local.get().then(storage => {\n    isReady = true\n    setActionIcon()\n\n    db = storage[readLater]\n\n    console.log(`${TAG} DB Loaded`, db);\n\n    browser.browserAction.setBadgeText({ text: `${db.length}` });\n});\n\nbrowser.commands.onCommand.addListener(async (command) => {\n    console.log(`${TAG} command= ${command}`);\n\n    switch (command) {\n        case readLater:\n            await savePages()\n            break;\n\n        case \"logTabs\":\n            saveTabs();\n            break;\n        case \"dublicateTab\":\n            dublicateTab();\n            break;\n        case \"open-in-bg\" || command == \"open-in-fg\":\n            openSelected(command)\n            break;\n        case \"fakeCtrlW\":\n            doFakeCtrW()\n            break;\n        default:\n            break;\n    }\n});\n\nfunction setActionIcon() {\n    console.log(`${TAG} isReady=`, isReady);\n}\n\nasync function savePages() {\n\n    if (!isReady) {\n        console.log(`${TAG} Extension not ready!`);\n        return\n    }\n\n    let tabs = await getTabsInfo()\n\n    browser.storage.local.get().then(storage => {\n        console.log(`${TAG} savePage`, storage);\n\n        db = storage[readLater]\n\n        let newTabs = tabs.filter(tab => !tabExisted(tab))\n\n        if (newTabs.length == 0) {\n            console.log(`${TAG} Tabs exist!`, tabs)\n            return\n        }\n\n        newTabs.forEach(tab => {\n            db.push(tab)\n        })\n\n        browser.storage.local.set({ \"read-later\": db }).then(function () {\n            console.log(`${TAG} SUCCESS saved ${newTabs.length} tabs.`);\n            updateBadge(db.length)\n        }, onError)\n    }, onError);\n}\n\nfunction onError(err) {\n    console.log(`${TAG} ERROR`, err);\n}\n\nfunction updateBadge(length) {\n    browser.storage.local.get().then(storage => {\n        browser.browserAction.setBadgeText({\n            text: `${length ? length : storage[readLater].length}`\n        });\n    });\n}\n\nfunction tabExisted(newTab) {\n    return db.some(tab => tab.url == newTab.url)\n}\n\nasync function getTabsInfo() {\n    let tabs = await browser.tabs.query({ highlighted: true, currentWindow: true })\n    return tabs.filter(tabValid).map(parseTabInfo)\n}\n\nfunction tabValid(tab) {\n    // TODO: regex tab\n    return tab.url?.startsWith(\"http\") ?? false\n}\n\nfunction parseTabInfo(tab) {\n    return {\n        url: tab.url,\n        title: tab.title,\n        // icon: tab.favIconUrl,\n        date: Date()\n    }\n}\n\n/*\nread-later: [\n    {url:title:date},\n    {url:title:date},\n    {url:title:date},\n],\n*/"],"names":["isURL","string","url","URL","e","isInCollection","tab","browser","storage","local","get","data","collection","i","length","startsWith","console","log","tabs","remove","id","TAG","browserAction","setBadgeBackgroundColor","readLater","isReady","then","set","src","des","omnibox","setDefaultSuggestion","description","onInputEntered","addListener","text","newURL","trim","omniboxs","forEach","box","chrome","update","db","setActionIcon","onError","err","tabValid","parseTabInfo","title","date","Date","onChanged","changes","area","changedItems","Object","keys","item","oldValue","newValue","setBadgeText","commands","onCommand","async","command","query","highlighted","currentWindow","filter","map","getTabsInfo","newTabs","newTab","some","push","savePages","res","reduce","pre","link","document","createElement","href","encodeURIComponent","JSON","stringify","download","click","active","create","openerTabId","index","sendMessage","action","response","openUrl","openSelected"],"sourceRoot":""}